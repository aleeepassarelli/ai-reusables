# ============================================================
# üß¨ MOLECULE DEFINITION ‚Äî Blueprint YAML
# ============================================================
# Cada mol√©cula √© uma composi√ß√£o sem√¢ntica de √°tomos.
# Ela representa um fluxo funcional aut√¥nomo e reutiliz√°vel.
# ============================================================

id: molecule.classify_text
name: "Text Classification Molecule"
version: "1.0.0"
type: "molecule"
author: "ELS Lab"
license: "MIT"

description: >
  Molecula que combina m√∫ltiplos √°tomos para realizar a tarefa de
  classifica√ß√£o de texto em categorias sem√¢nticas. O fluxo inclui:
  normaliza√ß√£o, vetoriza√ß√£o, c√°lculo de dist√¢ncia e decis√£o de classe.

tags:
  - nlp
  - pipeline
  - classification
  - atoms-composition

created_at: "2025-11-11"
last_modified: "2025-11-11"

# ============================================================
# üîπ Inputs e Outputs
# ============================================================

inputs:
  text:
    type: string
    description: "Texto bruto a ser classificado."
  candidate_labels:
    type: list
    description: "Lista de poss√≠veis categorias para classifica√ß√£o."

outputs:
  label:
    type: string
    description: "R√≥tulo mais prov√°vel do texto."
  confidence:
    type: float
    description: "N√≠vel de confian√ßa da classifica√ß√£o."

# ============================================================
# üîπ √Åtomos envolvidos (depend√™ncias diretas)
# ============================================================

atoms:
  - id: logic.normalize_text
    path: "../atoms/logic/normalize_text.py"
    function: "normalize_text"
  - id: logic.vector_distance
    path: "../atoms/logic/vector_distance.py"
    function: "vector_distance"
  - id: data_units.labels_dataset
    path: "../atoms/data_units/labels.json"
  - id: prompt_units.persona_expert
    path: "../atoms/prompt_units/persona_expert.yaml"

# ============================================================
# üîπ Pipeline ‚Äî Ordem de Execu√ß√£o
# ============================================================

pipeline:
  - step: normalize_input
    uses: logic.normalize_text
    input_map:
      text: "@inputs.text"
    output_map:
      normalized: "normalized_text"

  - step: vectorize
    uses: "embedding_model"
    input_map:
      text: "@pipeline.normalized_text"
    output_map:
      vector: "text_vector"

  - step: compare_with_labels
    uses: logic.vector_distance
    input_map:
      vector: "@pipeline.text_vector"
      labels: "@inputs.candidate_labels"
    output_map:
      scores: "label_scores"

  - step: choose_label
    uses: "internal.selector"
    input_map:
      scores: "@pipeline.label_scores"
    output_map:
      label: "predicted_label"
      confidence: "predicted_confidence"

# ============================================================
# üîπ Configura√ß√µes e Contexto Cognitivo
# ============================================================

context:
  prompt_profile: "@atoms.prompt_units.persona_expert"
  model: "qwen-4b-instruct"
  temperature: 0.3
  top_p: 0.9
  max_tokens: 512

# ============================================================
# üîπ Observabilidade
# ============================================================

metrics:
  log_steps: true
  save_vectors: false
  trace_enabled: true
  telemetry_topic: "molecule.classify_text.activity"

# ============================================================
# üîπ Depend√™ncias externas
# ============================================================

requirements:
  - torch>=2.0
  - sentence-transformers
  - scikit-learn
  - pyyaml
  - numpy
  - orjson

# ============================================================
# üîπ Exemplo de uso
# ============================================================

example:
  run: |
    from molecules.classify_text import run_molecule

    result = run_molecule(
        text="A IA est√° revolucionando a educa√ß√£o personalizada.",
        candidate_labels=["tecnologia", "educa√ß√£o", "sa√∫de"]
    )

    print(result)
  expected_output:
    label: "educa√ß√£o"
    confidence: 0.87

# ============================================================
# üîπ Inspira√ß√£o simb√≥lica
# ============================================================

symbolic_note: >
  Uma mol√©cula √© uma dan√ßa harm√¥nica de √°tomos,
  cada um vibrando com fun√ß√£o pr√≥pria, mas ressoando
  com um prop√≥sito comum: gerar sentido.
